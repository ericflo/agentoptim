# System Message Optimization Module

This module provides the core functionality for generating, evaluating, and ranking system messages in AgentOptim v2.2.0+.

## Architecture

The system message optimization module consists of several key components:

### Core Components

- **Generator**: Creates candidate system messages using meta-prompts
- **Evaluator**: Tests candidates against user messages using EvalSets
- **Ranker**: Scores and ranks candidates based on performance
- **Self-Optimizer**: Improves the meta-prompt based on performance feedback
- **Storage**: Persists optimization runs and generator versions

### File Structure

- **`__init__.py`**: Module exports
- **`core.py`**: Core optimization implementation
- **`hooks.py`**: CLI integration hooks
- **`README.md`**: This documentation file

## Usage

### From Python

```python
from agentoptim import optimize_system_messages_tool

# Basic usage
result = await optimize_system_messages_tool(
    action="optimize",
    user_query="How do I reset my password?",
    num_candidates=5,
    evalset_id="customer-support-quality"
)

# Get the best system message
best_system_message = result["candidates"][0]["system_message"]
```

### From CLI

```bash
# Generate and evaluate system messages
agentoptim optimize create --query "How do I reset my password?" --evalset customer-support-quality

# List past optimization runs
agentoptim optimize list

# Get detailed results from a specific run
agentoptim optimize get <run_id>
```

## Implementation Details

### Meta-Prompt Architecture

The system uses a specialized meta-prompt to generate candidate system messages. This meta-prompt:

1. Analyzes the user query to understand the domain and intent
2. Generates diverse system messages optimized for that context
3. Self-improves based on the performance of generated candidates

### Self-Optimization Loop

The self-optimization process works as follows:

1. Track performance of system messages generated by the current meta-prompt
2. When performance falls below thresholds or on manual trigger, generate an improved meta-prompt
3. Test the new meta-prompt against benchmarks
4. If better, adopt as the new default generator

### Storage

Optimization runs and generator versions are stored using the same persistent storage architecture as other AgentOptim components, with:

- Versioned storage for generators
- Full history of optimization runs
- Performance metrics and analysis for each run

## Development Guidelines

When extending this module:

1. Maintain backward compatibility with the API
2. Add comprehensive tests for new functionality
3. Update documentation to reflect changes
4. Follow the existing code style and architecture