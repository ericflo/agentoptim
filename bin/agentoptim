#!/usr/bin/env python3

"""
AgentOptim MCP Server - Command Line Entry Point

This script provides a command-line entry point for the AgentOptim MCP server.
"""

import os
import sys
import logging

# Add parent directory to path if needed for development
import os.path
parent_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
if os.path.exists(os.path.join(parent_dir, 'agentoptim')):
    sys.path.insert(0, parent_dir)

# Configure logging first
from agentoptim.utils import DATA_DIR, ensure_data_directories

# Ensure data directories exist
ensure_data_directories()

# Create a logger
log_file_path = os.path.join(DATA_DIR, "agentoptim.log")
logging.basicConfig(
    level=logging.DEBUG if os.environ.get("AGENTOPTIM_DEBUG", "0") == "1" else logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    handlers=[
        logging.StreamHandler(sys.stderr),  # Use stderr to avoid breaking MCP's stdio transport
        logging.FileHandler(log_file_path),
    ],
)

# Create logger at the global level
logger = logging.getLogger("agentoptim")

# Log configuration info
logger.info("AgentOptim MCP Server starting")
logger.info(f"Logging to {log_file_path}")
logger.info(f"Debug mode: {os.environ.get('AGENTOPTIM_DEBUG', '0') == '1'}")

# Now import the server components
try:
    from agentoptim.server import main
    main()
except Exception as e:
    logger.error(f"Error starting server: {str(e)}", exc_info=True)
    print(f"Error: {str(e)}", file=sys.stderr)
    sys.exit(1)